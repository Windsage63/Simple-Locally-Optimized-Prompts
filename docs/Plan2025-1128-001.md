# Implementation Plan - Workflow Update

## Goal
Update the application workflow to allow users to edit the "Input Idea" and re-optimize/refine with explicit control over whether to include chat history.

## Proposed Changes

### 1. UI Updates (`index.html`)
*   **Refine Button Area**: Add a checkbox `<input type="checkbox" id="include-chat" checked>` labeled "Include Chat" to the left of the Refine button.
    *   *Default*: Checked (to maintain current behavior).
*   **Prompt Settings Modal (Major Overhaul)**:
    *   **Header**: Change the "Customize System Prompts" button to a section header "Customize System Prompts".
    *   **Buttons**: Add four smaller buttons below the header:
        1.  **Optimize**: Opens modal/view to edit `slop_prompt_optimize`.
        2.  **Refine**: Opens modal/view to edit `slop_prompt_refine`.
        3.  **Refine (No Chat)**: Opens modal/view to edit `slop_prompt_refine_no_chat`.
        4.  **Chat Assistant**: Opens modal/view to edit `slop_prompt_chat`.
    *   **Interaction**: Each button should open a dedicated modal (or switch the view within the modal) for that specific prompt, reducing clutter.
### 2. Logic Updates (`js/app.js`)
*   **Refine Button Handler**:
    *   Read `prompt-input` value.
    *   Check `include-chat` checkbox.
    *   If checked: Call `client.refinePrompt` with `chatHistory`.
    *   If unchecked: Call `client.noChatRefinePrompt` without `chatHistory`.
*   **Prompt Settings Logic**:
    *   Load/Save the new `slop_prompt_refine_no_chat` setting.
    *   Add reset logic for this new prompt.

### 3. API Updates (`js/api.js`)
*   **Default Prompts**:
    *   Add `refine_no_chat` to `DEFAULT_PROMPTS`.
    *   *Draft Content*:
        ```
        You are an expert Prompt Engineer.
        Your task is to REFINE the Current Optimized Prompt based on the Updated User Idea.
        
        Updated User Idea:
        "{{originalPrompt}}"
        
        Current Optimized Prompt:
        {{currentResult}}
        
        Instructions:
        1. Compare the Updated User Idea with the Current Optimized Prompt.
        2. Adjust the prompt to better match the new requirements in the User Idea.
        3. Maintain the same YAML + Markdown format.
        ...
        ```
*   **`refinePrompt` Method**:
    *   Keep existing signature: `refinePrompt(originalPrompt, currentResult, chatHistory)`.
    *   Uses `slop_prompt_refine` template.
*   **`noChatRefinePrompt` Method (New)**:
    *   Signature: `noChatRefinePrompt(originalPrompt, currentResult)`.
    *   Uses `slop_prompt_refine_no_chat` template.
    *   Does NOT accept or process chat history.

## Verification Plan

### Manual Verification
1.  **Refine with Chat (Standard)**:
    *   Optimize a prompt.
    *   Chat to suggest a change (e.g., "Make it shorter").
    *   Leave "Include Chat" **Checked**.
    *   Click Refine.
    *   Verify the result incorporates the chat feedback.
2.  **Refine without Chat (New)**:
    *   Optimize a prompt.
    *   Chat (just to create history).
    *   Edit the "Input Idea" text (e.g., add "Make it funny").
    *   **Uncheck** "Include Chat".
    *   Click Refine.
    *   Verify the result incorporates the *Input Idea* change but *ignores* the chat instruction (if they conflicted, or just verify the request payload).
3.  **Settings Persistence**:
    *   Go to Settings > Customize Prompts.
    *   Edit "Refine Prompt (No Chat)".
    *   Save.
    *   Reload page.
    *   Verify change persists.
